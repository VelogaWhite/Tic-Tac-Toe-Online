rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // The 'games' collection
    match /games/{gameId} {
      
      // Anyone can read a game's state. This is safe because it's not sensitive data.
      allow read;
      
      // A user must be logged in to create a new game.
      allow create: if request.auth != null;
      
      // A user can only update a game if they are playerX or playerO in that game.
      // This prevents other people from interfering with a game they are not part of.
      allow update: if request.auth != null && (request.auth.uid == resource.data.playerX || request.auth.uid == resource.data.playerO);
      
      // Deleting games is not allowed through the client app.
      allow delete: if false;
    }

  }
}